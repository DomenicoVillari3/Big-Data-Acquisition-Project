version: '3.8'

services:
  spark-worker:
    build: . 
    container_name: spark-worker-${WORKER_ID:-1}
    
    environment:
      - SPARK_WORKER_CORES=4
      - SPARK_WORKER_MEMORY=16G
      - SPARK_WORKER_PORT=7078
      - SPARK_WORKER_WEBUI_PORT=8081
      # ✅ Questo gestisce l'IP host automaticamente
      - SPARK_LOCAL_IP=${HOST_IP}
    
    # ✅ COMANDO PULITO: Solo la classe e l'URL del Master
    command: >
      /opt/spark/bin/spark-class org.apache.spark.deploy.worker.Worker
      spark://192.168.128.236:7077
      
    ports:
      - "7078:7078"
      - "8081:8081"
    
    volumes:
      - /dev/shm:/dev/shm
      - ./datasets:/data
    
    network_mode: host